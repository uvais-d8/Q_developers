<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Q Developers - 3D Hero (Scroll Intro)</title>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
    <script src="https://unpkg.com/splitting/dist/splitting.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/splitting/dist/splitting.css" />

    <style>
        /* --- Basic Setup --- */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #0d0d0d;
            color: #ffffff;
            overflow: hidden; /* No scrollbars */
        }

        /* --- Hero Section (Fullscreen Container) --- */
        #hero-section {
            width: 100vw;
            height: 100vh;
            position: relative;
            overflow: hidden;

            /* --- Animated Blueprint Background --- */
            --grid-color: rgba(60, 80, 150, 0.2);
            --grid-size-sm: 20px;
            --grid-size-lg: 100px;
            background-color: #0d0d0d;
            background-image:
                linear-gradient(to right, var(--grid-color) 1px, transparent 1px),
                linear-gradient(to bottom, var(--grid-color) 1px, transparent 1px),
                linear-gradient(to right, var(--grid-color) 2px, transparent 2px),
                linear-gradient(to bottom, var(--grid-color) 2px, transparent 2px);
            background-size:
                var(--grid-size-sm) var(--grid-size-sm),
                var(--grid-size-sm) var(--grid-size-sm),
                var(--grid-size-lg) var(--grid-size-lg),
                var(--grid-size-lg) var(--grid-size-lg);
            animation: pan-grid 20s linear infinite;
        }

        @keyframes pan-grid {
            0% { background-position: 0 0; }
            100% { background-position: var(--grid-size-lg) var(--grid-size-lg); }
        }

        /* --- 3D Canvas (Middle Layer) --- */
        #three-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10; 
        }

        /* --- Hero Text (Back Layer) --- */
        .hero-text-container {
            position: absolute;
            inset: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 5; 
        }

        .hero-head {
            font-size: clamp(4rem, 15vw, 12rem);
            font-weight: 800;
            color: rgba(255, 255, 255, 0.9);
            letter-spacing: -0.02em;
            text-transform: uppercase;
        }

        /* --- UI Elements (Top Layer) --- */
        .glass-ui {
            background: rgba(10, 10, 10, 0.3);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.05);
            color: #aaa;
            font-size: 13px;
        }
        
        .controls-ui {
            position: absolute;
            top: 40px;
            right: 40px;
            z-index: 20;
            padding: 10px;
            border-radius: 8px;
            text-align: right;
            font-family: 'Courier New', Courier, monospace;
        }
        .controls-ui p {
            font-size: 12px;
            color: #fff;
            margin-bottom: 5px;
        }
        .controls-ui .compass {
            width: 60px;
            height: 60px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 50%;
            margin-left: auto;
            border: 1px solid #555;
            position: relative;
            transition: transform 0.1s linear;
        }
        .controls-ui .compass::after {
            content: '+';
            font-size: 20px;
            color: #fff;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        #quaternion-display {
            display: inline-block;
            width: 100%;
            color: #00ffaa;
            letter-spacing: 1px;
        }

        .news-panel {
            position: absolute;
            bottom: 40px;
            right: 40px;
            z-index: 20;
            padding: 20px;
            border-radius: 8px;
            width: 280px;
        }
        
        .news-panel h3 {
            font-size: 14px;
            color: #fff;
            margin-bottom: 15px;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .news-panel p {
            font-size: 12px;
            line-height: 1.6;
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 1px solid #444;
        }
        .news-panel p:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }
        .news-panel span {
            display: block;
            font-size: 11px;
            color: #888;
        }
        
        /* --- Splitting.js Animation Setup --- */
        .char {
            display: inline-block;
            opacity: 0;
            transform: translateY(40px) scale(0.8);
        }

        /* --- Hide UI elements for intro --- */
        .hide-on-load {
            opacity: 0;
        }

    </style>
</head>
<body>

    <main id="hero-section">
        
        <canvas id="three-canvas"></canvas>
        
        <div class="hero-text-container hide-on-load">
            <h1 class="hero-head" data-splitting>Q Developers</h1>
        </div>

        <div class="controls-ui glass-ui hide-on-load">
            <p>Q.model Quaternion</p>
            <span id="quaternion-display">.00 .00 .00 1.00</span>
            <div class="compass"></div>
        </div>

        <div class="news-panel glass-ui hide-on-load">
            <h3>NEWS</h3>
            <p><span>2025.10.28</span>Q Developers featured in 'Modern Homes' magazine.</p>
            <p><span>2025.09.15</span>New 'Skyline' project announced for Calicut.</p>
        </div>
        
    </main>

    <script type="importmap">
    {
        "imports": {
            "three": "https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.module.js",
            "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.158.0/examples/jsm/"
        }
    }
    </script>

    <script type="module">
        import * as THREE from 'three';

        // 1. --- APP STATE ---
        const app = {
            scene: null,
            camera: null,
            renderer: null,
            qModel: null,
            clock: null, 
            container: document.getElementById('hero-section'),
            canvas: document.getElementById('three-canvas'),
            quaternionDisplay: null,
            compass: null
        };
        
        const mouse = new THREE.Vector2();
        
        // --- Animation State ---
        let introTimeline = null;
        let introStarted = false;
        
        // 2. --- INITIALIZE 3D SCENE ---
        function init() {
            app.clock = new THREE.Clock();

            app.quaternionDisplay = document.getElementById('quaternion-display');
            app.compass = document.querySelector('.controls-ui .compass');

            app.scene = new THREE.Scene();

            const fov = 45;
            const aspect = app.container.clientWidth / app.container.clientHeight;
            const near = 0.1;
            const far = 100;
            app.camera = new THREE.PerspectiveCamera(fov, aspect, near, far);
            
            // --- â˜… MODIFIED: Start camera extremely close ---
            app.camera.position.set(0, 0, 0.4); // Was 0.8
            
            app.scene.add(app.camera);

            app.renderer = new THREE.WebGLRenderer({
                canvas: app.canvas,
                antialias: true,
                alpha: true
            });
            app.renderer.setSize(app.container.clientWidth, app.container.clientHeight);
            app.renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));

            const ambientLight = new THREE.AmbientLight(0xffffff, 0.7);
            app.scene.add(ambientLight);

            const directionalLight = new THREE.DirectionalLight(0xffffff, 2.5);
            directionalLight.position.set(5, 5, 10);
            app.scene.add(directionalLight);
            
            const pointLight = new THREE.PointLight(0xffffff, 1.5);
            pointLight.position.set(-5, -5, 10);
            app.scene.add(pointLight);

            createQModel();

            // --- Setup the new GSAP intro animation ---
            setupIntroAnimation();

            // Event Listeners
            window.addEventListener('resize', onResize);
            app.container.addEventListener('mousemove', onMouseMove);
            
            // --- Added scroll listener for intro ---
            window.addEventListener('wheel', onScrollIntro, { passive: false });

            animate();
        }

        // 3. --- CREATE THE "Q" MODEL ---
        function createQModel() {
            // ... (Your Q-model geometry creation is unchanged)
            const rotationAngle = -Math.PI / 4;
            const outerCurve = new THREE.EllipseCurve(0, 0, 1.5, 1.5, 0, Math.PI * 2, false, rotationAngle);
            const innerCurve = new THREE.EllipseCurve(0, 0, 0.8, 0.8, 0, Math.PI * 2, false, rotationAngle);
            const oShape = new THREE.Shape(outerCurve.getPoints(128));
            const holePath = new THREE.Path(innerCurve.getPoints(128));
            oShape.holes.push(holePath);
            const tailShape = new THREE.Shape();
            const innerRadius = 0.8, outerRadius = 1.5;
            const p1 = { x: innerRadius * 0.6, y: -innerRadius * 0.6 };
            const p2 = { x: outerRadius * 1.3, y: -outerRadius * 1.3 };
            const p3 = { x: p2.x - 0.4, y: p2.y + 0.1 };
            const p4 = { x: p1.x - 0.3, y: p1.y + 0.05 };
            tailShape.moveTo(p1.x, p1.y); tailShape.lineTo(p2.x, p2.y); tailShape.lineTo(p3.x, p3.y); tailShape.lineTo(p4.x, p4.y);
            const extrudeSettings = { depth: 0.7, bevelEnabled: true, bevelSegments: 5, steps: 2, bevelSize: 0.1, bevelThickness: 0.1 };
            const geometry = new THREE.ExtrudeGeometry([oShape, tailShape], extrudeSettings);
            geometry.center();

            const cubeTextureLoader = new THREE.CubeTextureLoader();
            const envMap = cubeTextureLoader.setPath('https://threejs.org/examples/textures/cube/Park2/')
                .load(['posx.jpg', 'negx.jpg', 'posy.jpg', 'negy.jpg', 'posz.jpg', 'negz.jpg']);
            
            // --- Material starts as "full white" ---
            const material = new THREE.MeshPhysicalMaterial({
                color: 0xffffff,       // Start as pure white
                metalness: 0.1,
                roughness: 1.0,      // Start as diffuse (not shiny)
                transmission: 0.0,   // Start as opaque
                thickness: 2.5,
                envMap: envMap,
                envMapIntensity: 1.5,
                ior: 1.5,
            });

            app.qModel = new THREE.Mesh(geometry, material);
            app.qModel.scale.set(1.5, 1.5, 1.5);
            app.scene.add(app.qModel);
        }

        // 4. --- ANIMATION & EVENTS ---

        // --- GSAP Scroll-Intro Animation ---
        function setupIntroAnimation() {
            // Run Splitting.js to prepare the text
            Splitting();

            const material = app.qModel.material;
            const targetGlassColor = new THREE.Color(0xe0ffff);
            
            introTimeline = gsap.timeline({ paused: true });

            // 1. Zoom out camera
            introTimeline.to(app.camera.position, {
                z: 8, // The final camera position
                duration: 2.5,
                ease: "power2.inOut"
            }, 0); // Start at 0 seconds

            // 2. Animate material from "White" to "Glass"
            introTimeline.to(material, {
                transmission: 1.0,
                roughness: 0.0,
                duration: 2.0,
                ease: "power1.inOut"
            }, 0.5); // Start 0.5s into the zoom

            // 2b. Animate color to the blue tint
            introTimeline.to(material.color, {
                r: targetGlassColor.r,
                g: targetGlassColor.g,
                b: targetGlassColor.b,
                duration: 2.0,
                ease: "power1.inOut"
            }, 0.5);

            // 3. Fade in the UI elements
            introTimeline.to(".hide-on-load", {
                opacity: 1,
                duration: 1.5,
                stagger: 0.1,
                ease: "power2.out"
            }, 1.0); // Start 1s in

            // 4. Animate the text characters (from original code)
            introTimeline.to(".hero-head .char", {
                opacity: 1,
                y: 0,
                scale: 1,
                stagger: 0.04,
                delay: 0.5, // This is a delay *within* the timeline step
                ease: "expo.out",
                duration: 1.5
            }, 1.0); // Start at the same time as UI fade
        }

        // --- Scroll event handler to trigger the animation ---
        function onScrollIntro(event) {
            if (introStarted) {
                // If animation is done, allow normal scroll behavior (if any)
                return;
            }
            
            // Prevent the page from actually scrolling
            event.preventDefault();

            // Only trigger on scroll down
            if (event.deltaY > 0) {
                introStarted = true;
                introTimeline.play();
                
                // Optional: remove listener after it's fired
                window.removeEventListener('wheel', onScrollIntro);
            }
        }

        function animate() {
            requestAnimationFrame(animate);
            
            const elapsedTime = app.clock.getElapsedTime();

            if (app.qModel) {
                // This subtle bobbing can happen regardless of intro
                app.qModel.position.y = Math.sin(elapsedTime * 0.7) * 0.05;

                // --- Only run mouse-follow and UI updates *after* intro starts ---
                if (introStarted) {
                    const lerpFactor = 0.05; 
                    
                    let targetX = mouse.y * 0.5;
                    let targetY = mouse.x * 0.5;

                    app.qModel.rotation.x += (targetX - app.qModel.rotation.x) * lerpFactor;
                    app.qModel.rotation.y += (targetY - app.qModel.rotation.y) * lerpFactor;
                    
                    if (app.quaternionDisplay) {
                        const q = app.qModel.quaternion;
                        app.quaternionDisplay.textContent = `${q.x.toFixed(2)} ${q.y.toFixed(2)} ${q.z.toFixed(2)} ${q.w.toFixed(2)}`;
                    }

                    if (app.compass) {
                        app.compass.style.transform = `rotate(${app.qModel.rotation.y}rad)`;
                    }
                }
            }

            app.renderer.render(app.scene, app.camera);
        }

        function onResize() {
            const width = app.container.clientWidth;
            const height = app.container.clientHeight;

            app.camera.aspect = width / height;
            app.camera.updateProjectionMatrix();

            app.renderer.setSize(width, height);
            app.renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        }
        
        function onMouseMove(event) {
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
        }

        // 5. --- RUN EVERYTHING ---
        init();
        
        // 6. --- TEXT ANIMATION ---
        document.addEventListener("DOMContentLoaded", function() {
            // Splitting() is now called from setupIntroAnimation()
            // to ensure it runs before the timeline is built.
        });

    </script>
</body>
</html>